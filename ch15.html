<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>15&nbsp; Arrays of Arrays – Think Java</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ch16.html" rel="next">
<link href="./ch14.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="custom.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ch01.html">Chapters</a></li><li class="breadcrumb-item"><a href="./ch15.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Arrays of Arrays</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Think Java</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Front Matter</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Chapters</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Computer Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Variables and Operators</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Input and Output</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Methods and Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Conditionals and Logic</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Loops and Strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Arrays and References</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Recursive Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Immutable Objects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Mutable Objects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Designing Classes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Arrays of Objects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Objects of Arrays</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Extending Classes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch15.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Arrays of Arrays</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Reusing Classes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Advanced Topics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Tools</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Javadoc</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Graphics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Debugging</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#conways-game-of-life" id="toc-conways-game-of-life" class="nav-link active" data-scroll-target="#conways-game-of-life"><span class="header-section-number">15.1</span> Conway’s Game of Life</a></li>
  <li><a href="#the-cell-class" id="toc-the-cell-class" class="nav-link" data-scroll-target="#the-cell-class"><span class="header-section-number">15.2</span> The Cell Class</a></li>
  <li><a href="#two-dimensional-arrays" id="toc-two-dimensional-arrays" class="nav-link" data-scroll-target="#two-dimensional-arrays"><span class="header-section-number">15.3</span> Two-Dimensional Arrays</a></li>
  <li><a href="#the-gridcanvas-class" id="toc-the-gridcanvas-class" class="nav-link" data-scroll-target="#the-gridcanvas-class"><span class="header-section-number">15.4</span> The GridCanvas Class</a></li>
  <li><a href="#other-grid-methods" id="toc-other-grid-methods" class="nav-link" data-scroll-target="#other-grid-methods"><span class="header-section-number">15.5</span> Other Grid Methods</a></li>
  <li><a href="#conwaymain" id="toc-conwaymain" class="nav-link" data-scroll-target="#conwaymain"><span class="header-section-number">15.6</span> Starting the Game</a></li>
  <li><a href="#mainloop" id="toc-mainloop" class="nav-link" data-scroll-target="#mainloop"><span class="header-section-number">15.7</span> The Simulation Loop</a></li>
  <li><a href="#exception-handling" id="toc-exception-handling" class="nav-link" data-scroll-target="#exception-handling"><span class="header-section-number">15.8</span> Exception Handling</a></li>
  <li><a href="#counting-neighbors" id="toc-counting-neighbors" class="nav-link" data-scroll-target="#counting-neighbors"><span class="header-section-number">15.9</span> Counting Neighbors</a></li>
  <li><a href="#sec:update" id="toc-sec:update" class="nav-link" data-scroll-target="#sec\:update"><span class="header-section-number">15.10</span> Updating the Grid</a></li>
  <li><a href="#vocabulary" id="toc-vocabulary" class="nav-link" data-scroll-target="#vocabulary"><span class="header-section-number">15.11</span> Vocabulary</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">15.12</span> Exercises</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ch01.html">Chapters</a></li><li class="breadcrumb-item"><a href="./ch15.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Arrays of Arrays</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="conway" class="quarto-section-identifier"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Arrays of Arrays</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The last three chapters of this book use 2D graphics to illustrate more advanced object-oriented concepts. If you haven’t yet read Appendix&nbsp;<a href="#graphics" data-reference-type="ref" data-reference="graphics">20</a>, you might want to read it now and become familiar with the <code class="sourceCode java"><span class="bu">Canvas</span></code>, <code class="sourceCode java"><span class="bu">Color</span></code>, and <code class="sourceCode java"><span class="bu">Graphics</span></code> classes from the <code class="sourceCode java">java<span class="op">.</span><span class="fu">awt</span></code> package. In this chapter, we use these classes to draw images and animations, and to run graphical simulations.</p>
<section id="conways-game-of-life" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="conways-game-of-life"><span class="header-section-number">15.1</span> Conway’s Game of Life</h2>
<p>The Game of Life, or GoL for short, was developed by John Conway and popularized in 1970 in Martin Gardner’s column in <em>Scientific American</em>. Conway calls it a “zero-player game” because no players are needed to choose strategies or make decisions. After you set up the initial conditions, you watch the game play itself. That turns out to be more interesting than it sounds; you can read about it at <a href="https://en.wikipedia.org/wiki/Conway's_Game_of_Life" class="uri">https://en.wikipedia.org/wiki/Conway's_Game_of_Life</a>.</p>
<p>The game board is a 2D grid of square cells. Each cell is either “alive” or “dead”; the color of the cell indicates its state. Figure&nbsp;<a href="#fig:glider" data-reference-type="ref" data-reference="fig:glider">15.1</a> shows an example grid configuration; the five black cells are alive.</p>
<figure id="fig:glider" class="figure">
<div class="center">
<p><img src="figs/glider.png" class="figure-img"></p>
</div>
<figcaption>
A “Glider” in the Game of Life.
</figcaption>
</figure>
<p>The game proceeds in time steps, during which each cell interacts with its neighbors in the eight adjacent cells. At each time step, the following rules are applied:</p>
<ul>
<li><p>A live cell with fewer than two live neighbors dies, as if by underpopulation.</p></li>
<li><p>A live cell with more than three live neighbors dies, as if by overpopulation.</p></li>
<li><p>A dead cell with exactly three live neighbors becomes a live cell, as if by reproduction.</p></li>
</ul>
<p>Notice some consequences of these rules. If you start with a single live cell, it dies. If all cells are dead, no cells come to life. But if you have four cells in a square, they keep each other alive, so that’s a “stable” configuration.</p>
<p>Another initial configuration is shown in Figure&nbsp;<a href="#fig:blinker" data-reference-type="ref" data-reference="fig:blinker">15.2</a>. If you start with three horizontal cells, the center cell lives, the left and right cells die, and the top and bottom cells come to life. The result after the first time step is three vertical cells.</p>
<p>During the next time step, the center cell lives, the top and bottom cells die, and the left and right cells come to life. The result is three horizontal cells, so we’re back where we started, and the cycle repeats forever.</p>
<figure id="fig:blinker" class="figure">
<div class="center">
<p><img src="figs/figure15-2.png" style="width:95.0%" class="figure-img"></p>
</div>
<figcaption>
A “Blinker” in the Game of Life.
</figcaption>
</figure>
<p>Patterns like this are called “periodic”, because they repeat after a period of two or more time steps. But they are also considered stable, because the total number of live cells doesn’t grow over time.</p>
<p>Most simple starting configurations either die out quickly or reach a stable configuration. But there are a few starting conditions that display remarkable complexity. One of those is the R-pentomino (<a href="https://www.conwaylife.com/wiki/R-pentomino" class="uri">https://www.conwaylife.com/wiki/R-pentomino</a>), which starts with only five cells, runs for 1,103 time steps, and ends in a stable configuration with 116 live cells.</p>
<p>In the following sections, we’ll implement the Game of Life in Java. We’ll first implement the cells, then the grid of cells, and finally the game itself.</p>
</section>
<section id="the-cell-class" class="level2" data-number="15.2">
<h2 data-number="15.2" class="anchored" data-anchor-id="the-cell-class"><span class="header-section-number">15.2</span> The Cell Class</h2>
<p>When drawing a cell, we’ll need to know its location on the screen and size in pixels. To represent the location, we use the <code class="sourceCode java">x</code> and <code class="sourceCode java">y</code> coordinates of the upper-left corner. And to represent the size, we use an integer, <code class="sourceCode java">size</code>.</p>
<p>To represent the state of a cell, we use an integer, <code class="sourceCode java">state</code>, which is <code class="sourceCode java"><span class="dv">0</span></code> for dead cells and <code class="sourceCode java"><span class="dv">1</span></code> for live cells. We could use a <code class="sourceCode java"><span class="dt">boolean</span></code> instead, but it’s good practice to design classes to be reusable (e.g., for other games that have more states).</p>
<p>Here is a <code class="sourceCode java">Cell</code> class that declares these instance variables:</p>
<div class="sourceCode" id="cb1" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Cell <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> y<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> size<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span> state<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice that <code class="sourceCode java">x</code>, <code class="sourceCode java">y</code>, and <code class="sourceCode java">size</code> are constants. Once the cell is created, we don’t want it to move or change size. But <code class="sourceCode java">state</code> can and should change, so it is not a constant.</p>
<p>The next step is to write a constructor. Here’s one that takes <code class="sourceCode java">x</code>, <code class="sourceCode java">y</code>, and <code class="sourceCode java">size</code> as parameters, and sets <code>state</code> to a default value:</p>
<div class="sourceCode" id="cb2" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="fu">Cell</span><span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">,</span> <span class="dt">int</span> size<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">x</span> <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">y</span> <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">size</span> <span class="op">=</span> size<span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">state</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The following method draws a cell. Like the <code class="sourceCode java">paint</code> method in Appendix&nbsp;<a href="#graphics" data-reference-type="ref" data-reference="graphics">20</a>, it takes a graphics context as a parameter:</p>
<div class="sourceCode" id="cb3" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">Color</span><span class="op">[]</span> COLORS <span class="op">=</span> <span class="op">{</span><span class="bu">Color</span><span class="op">.</span><span class="fu">WHITE</span><span class="op">,</span> <span class="bu">Color</span><span class="op">.</span><span class="fu">BLACK</span><span class="op">};</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">draw</span><span class="op">(</span><span class="bu">Graphics</span> g<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    g<span class="op">.</span><span class="fu">setColor</span><span class="op">(</span>COLORS<span class="op">[</span>state<span class="op">]);</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    g<span class="op">.</span><span class="fu">fillRect</span><span class="op">(</span>x <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> y <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> size <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> size <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    g<span class="op">.</span><span class="fu">setColor</span><span class="op">(</span><span class="bu">Color</span><span class="op">.</span><span class="fu">LIGHT_GRAY</span><span class="op">);</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    g<span class="op">.</span><span class="fu">drawRect</span><span class="op">(</span>x<span class="op">,</span> y<span class="op">,</span> size<span class="op">,</span> size<span class="op">);</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code class="sourceCode java">draw</code> method uses the state of the cell to select a color from an array of <code class="sourceCode java"><span class="bu">Color</span></code> objects. Then it uses to <code class="sourceCode java">fillRect</code> to draw the center of the cell and <code class="sourceCode java">drawRect</code> to draw a light-gray border.</p>
<p>We also need methods to get and set the cell’s state. We could just provide <code class="sourceCode java">getState</code> and <code class="sourceCode java">setState</code>, but the code will be more readable if we provide methods customized for the Game of Life:</p>
<div class="sourceCode" id="cb4" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">isOff</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> state <span class="op">==</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">isOn</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> state <span class="op">==</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">turnOff</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">turnOn</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="two-dimensional-arrays" class="level2" data-number="15.3">
<h2 data-number="15.3" class="anchored" data-anchor-id="two-dimensional-arrays"><span class="header-section-number">15.3</span> Two-Dimensional Arrays</h2>
<p>To represent a grid of cells, we can use a <strong>multidimensional array</strong>. To create a 2D array, we specify the number of rows and columns:</p>
<div class="sourceCode" id="cb5" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> rows <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cols <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>Cell<span class="op">[][]</span> array <span class="op">=</span> <span class="kw">new</span> Cell<span class="op">[</span>rows<span class="op">][</span>cols<span class="op">];</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The result is an array with four rows and three columns. Initially, the elements of the array are <code class="sourceCode java"><span class="kw">null</span></code>. We can fill the array with <code class="sourceCode java">Cell</code> objects like this:</p>
<div class="sourceCode" id="cb6" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> r <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> r <span class="op">&lt;</span> rows<span class="op">;</span> r<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> y <span class="op">=</span> r <span class="op">*</span> size<span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> c <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> c <span class="op">&lt;</span> cols<span class="op">;</span> c<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> x <span class="op">=</span> c <span class="op">*</span> size<span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        array<span class="op">[</span>r<span class="op">][</span>c<span class="op">]</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Cell</span><span class="op">(</span>x<span class="op">,</span> y<span class="op">,</span> size<span class="op">);</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The loop variables <code class="sourceCode java">r</code> and <code class="sourceCode java">c</code> are the row and column indexes of the cells. The variables <code class="sourceCode java">x</code> and <code class="sourceCode java">y</code> are the coordinates, respectively. For example, if <code class="sourceCode java">size</code> is 10 pixels, the cell at index (1, 2) would be at coordinates (10, 20) on the screen.</p>
<p>In Java, a 2D array is really an array of arrays. You can think of it as an array of rows, where each row is an array. Figure&nbsp;<a href="#fig:2D-array" data-reference-type="ref" data-reference="fig:2D-array">15.3</a> shows what it looks like.</p>
<figure id="fig:2D-array" class="figure">
<div class="center">
<p><img src="figs/2D-array-.svg" class="figure-img"></p>
</div>
<figcaption>
Storing rows and columns with a 2D array.
</figcaption>
</figure>
<p>When we write <code class="sourceCode java">array<span class="op">[</span>r<span class="op">][</span>c<span class="op">]</span></code>, Java uses the first index to select a row and the second index to select an element from the row. This way of representing 2D data is known as <strong>row-major order</strong>.</p>
</section>
<section id="the-gridcanvas-class" class="level2" data-number="15.4">
<h2 data-number="15.4" class="anchored" data-anchor-id="the-gridcanvas-class"><span class="header-section-number">15.4</span> The GridCanvas Class</h2>
<p>Now that we have a <code class="sourceCode java">Cell</code> class and a way to represent a 2D array of cells, we can write a class to represent a grid of cells. We encapsulate the code from the previous section and generalize it to construct a grid with any number of rows and columns:</p>
<div class="sourceCode" id="cb7" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> GridCanvas <span class="kw">extends</span> <span class="bu">Canvas</span> <span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> Cell<span class="op">[][]</span> array<span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">GridCanvas</span><span class="op">(</span><span class="dt">int</span> rows<span class="op">,</span> <span class="dt">int</span> cols<span class="op">,</span> <span class="dt">int</span> size<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        array <span class="op">=</span> <span class="kw">new</span> Cell<span class="op">[</span>rows<span class="op">][</span>cols<span class="op">];</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> r <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> r <span class="op">&lt;</span> rows<span class="op">;</span> r<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> y <span class="op">=</span> r <span class="op">*</span> size<span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> c <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> c <span class="op">&lt;</span> cols<span class="op">;</span> c<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                <span class="dt">int</span> x <span class="op">=</span> c <span class="op">*</span> size<span class="op">;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                array<span class="op">[</span>r<span class="op">][</span>c<span class="op">]</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Cell</span><span class="op">(</span>x<span class="op">,</span> y<span class="op">,</span> size<span class="op">);</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// set the canvas size</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setSize</span><span class="op">(</span>cols <span class="op">*</span> size<span class="op">,</span> rows <span class="op">*</span> size<span class="op">);</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Using vocabulary from the previous chapter, <code class="sourceCode java">GridCanvas</code> “is&nbsp;a” <code class="sourceCode java"><span class="bu">Canvas</span></code> that “has&nbsp;a” 2D array of cells. By extending the <code class="sourceCode java"><span class="bu">Canvas</span></code> class from <code class="sourceCode java">java<span class="op">.</span><span class="fu">awt</span></code>, we inherit methods for drawing graphics on the screen.</p>
<p>In fact, the code is surprisingly straightforward: to draw the grid, we simply draw each cell. We use nested <code class="sourceCode java"><span class="cf">for</span></code> loops to traverse the 2D array:</p>
<div class="sourceCode" id="cb8" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">draw</span><span class="op">(</span><span class="bu">Graphics</span> g<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>Cell<span class="op">[]</span> row <span class="op">:</span> array<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span>Cell cell <span class="op">:</span> row<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>            cell<span class="op">.</span><span class="fu">draw</span><span class="op">(</span>g<span class="op">);</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The outer loop traverses the rows; the inner loop traverses the cells in each row. You can almost read this method in English: “For each <code class="sourceCode java">row</code> in the <code class="sourceCode java">array</code>, and for each <code class="sourceCode java">cell</code> in the <code class="sourceCode java">row</code>, draw the <code class="sourceCode java">cell</code> in the graphics context.” Each cell contains its coordinates and size, so it knows how to draw itself.</p>
<p>Classes that extend <code class="sourceCode java"><span class="bu">Canvas</span></code> are supposed to provide a method called <code class="sourceCode java">paint</code> that “paints” the contents of the <code class="sourceCode java"><span class="bu">Canvas</span></code>. It gets invoked when the <code class="sourceCode java"><span class="bu">Canvas</span></code> is created and anytime it needs to be redrawn; for example, when its window is moved or resized.</p>
<p>Here’s the <code class="sourceCode java">paint</code> method for <code class="sourceCode java">GridCanvas</code>. When the window management system calls <code class="sourceCode java">paint</code>, <code class="sourceCode java">paint</code> calls <code class="sourceCode java">draw</code>, which draws the cells:</p>
<div class="sourceCode" id="cb9" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">paint</span><span class="op">(</span><span class="bu">Graphics</span> g<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw</span><span class="op">(</span>g<span class="op">);</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="other-grid-methods" class="level2" data-number="15.5">
<h2 data-number="15.5" class="anchored" data-anchor-id="other-grid-methods"><span class="header-section-number">15.5</span> Other Grid Methods</h2>
<p>In addition to <code class="sourceCode java">draw</code> and <code class="sourceCode java">paint</code>, the <code class="sourceCode java">GridCanvas</code> class provides methods for working with the grid itself. <code class="sourceCode java">numRows</code> and <code class="sourceCode java">numCols</code> return the number of rows and columns. We can get this information from the 2D array, using <code class="sourceCode java">length</code>:</p>
<div class="sourceCode" id="cb10" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">int</span> <span class="fu">numRows</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> array<span class="op">.</span><span class="fu">length</span><span class="op">;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">int</span> <span class="fu">numCols</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> array<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">length</span><span class="op">;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Because we are using row-major order, the 2D array is an array of rows. <code class="sourceCode java">numRows</code> simply returns the length of the rows array. <code class="sourceCode java">numCols</code> returns the length of the first row, which is the number of columns. Since the rows all have the same length, we have to check only one.</p>
<p><code class="sourceCode java">GridCanvas</code> also provides a method that gets the <code class="sourceCode java">Cell</code> at a given location, and for convenience when starting the game, a method that turns on the <code class="sourceCode java">Cell</code> at a given location.</p>
<div class="sourceCode" id="cb11" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Cell <span class="fu">getCell</span><span class="op">(</span><span class="dt">int</span> r<span class="op">,</span> <span class="dt">int</span> c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> array<span class="op">[</span>r<span class="op">][</span>c<span class="op">];</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">turnOn</span><span class="op">(</span><span class="dt">int</span> r<span class="op">,</span> <span class="dt">int</span> c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    array<span class="op">[</span>r<span class="op">][</span>c<span class="op">].</span><span class="fu">turnOn</span><span class="op">();</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="conwaymain" class="level2" data-number="15.6">
<h2 data-number="15.6" class="anchored" data-anchor-id="conwaymain"><span class="header-section-number">15.6</span> Starting the Game</h2>
<p>Now we’re ready to implement the game. To encapsulate the rules of GoL, we define a class named <code class="sourceCode java">Conway</code>. The <code class="sourceCode java">Conway</code> class “has&nbsp;a” <code class="sourceCode java">GridCanvas</code> that represents the state of the game.</p>
<p>This constructor makes a <code class="sourceCode java">GridCanvas</code> with 5 rows and 10 columns, with cells that are 20 pixels wide and high. It then sets up the initial conditions:</p>
<div class="sourceCode" id="cb12" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Conway <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> GridCanvas grid<span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">Conway</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        grid <span class="op">=</span> <span class="kw">new</span> <span class="fu">GridCanvas</span><span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        grid<span class="op">.</span><span class="fu">turnOn</span><span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        grid<span class="op">.</span><span class="fu">turnOn</span><span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        grid<span class="op">.</span><span class="fu">turnOn</span><span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        grid<span class="op">.</span><span class="fu">turnOn</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">7</span><span class="op">);</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        grid<span class="op">.</span><span class="fu">turnOn</span><span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">7</span><span class="op">);</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        grid<span class="op">.</span><span class="fu">turnOn</span><span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="dv">7</span><span class="op">);</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Before we implement the rest of the game, we’ll write a <code class="sourceCode java">main</code> method that creates a <code class="sourceCode java">Conway</code> object and displays it. We can use this method to test <code class="sourceCode java">Cell</code> and <code class="sourceCode java">GridCanvas</code>, and to develop the other methods we need:</p>
<div class="sourceCode" id="cb13" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> title <span class="op">=</span> <span class="st">"Conway's Game of Life"</span><span class="op">;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    Conway game <span class="op">=</span> <span class="kw">new</span> <span class="fu">Conway</span><span class="op">();</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">JFrame</span> frame <span class="op">=</span> <span class="kw">new</span> <span class="bu">JFrame</span><span class="op">(</span>title<span class="op">);</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    frame<span class="op">.</span><span class="fu">setDefaultCloseOperation</span><span class="op">(</span><span class="bu">JFrame</span><span class="op">.</span><span class="fu">EXIT_ON_CLOSE</span><span class="op">);</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    frame<span class="op">.</span><span class="fu">setResizable</span><span class="op">(</span><span class="kw">false</span><span class="op">);</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    frame<span class="op">.</span><span class="fu">add</span><span class="op">(</span>game<span class="op">.</span><span class="fu">grid</span><span class="op">);</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    frame<span class="op">.</span><span class="fu">pack</span><span class="op">();</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    frame<span class="op">.</span><span class="fu">setVisible</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    game<span class="op">.</span><span class="fu">mainloop</span><span class="op">();</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After constructing the <code class="sourceCode java">game</code> object, <code class="sourceCode java">main</code> constructs a <code class="sourceCode java"><span class="bu">JFrame</span></code>, which creates a window on the screen. The <code class="sourceCode java"><span class="bu">JFrame</span></code> is configured to exit the program when closed. Resizing the window is disabled.</p>
<p><code class="sourceCode java">main</code> then adds the <code class="sourceCode java">GridCanvas</code> inside the frame, resizes (“packs”) the frame to fit the canvas, and makes the frame visible. Figure&nbsp;<a href="#fig:conway" data-reference-type="ref" data-reference="fig:conway">15.4</a> shows the result.</p>
<figure id="fig:conway" class="figure">
<div class="center">
<p><img src="figs/conway.png" class="figure-img"></p>
</div>
<figcaption>
Screenshot of the initial <code class="sourceCode java">Conway</code> application.
</figcaption>
</figure>
</section>
<section id="mainloop" class="level2" data-number="15.7">
<h2 data-number="15.7" class="anchored" data-anchor-id="mainloop"><span class="header-section-number">15.7</span> The Simulation Loop</h2>
<p>At the end of <code class="sourceCode java">main</code>, we call <code class="sourceCode java">mainloop</code>, which uses a <code class="sourceCode java"><span class="cf">while</span></code> loop to simulate the time steps of the Game of Life. Here’s a rough draft of this method:</p>
<div class="sourceCode" id="cb14" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">mainloop</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="kw">true</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">update</span><span class="op">();</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        grid<span class="op">.</span><span class="fu">repaint</span><span class="op">();</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Thread</span><span class="op">.</span><span class="fu">sleep</span><span class="op">(</span><span class="dv">500</span><span class="op">);</span>    <span class="co">// compiler error</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>During each time step, we update the state of the game and repaint the <code class="sourceCode java">grid</code>. We will present the <code class="sourceCode java">update</code> method in Section&nbsp;<a href="#sec:update" data-reference-type="ref" data-reference="sec:update">15.10</a>.</p>
<p><code class="sourceCode java">repaint</code> comes from the <code class="sourceCode java"><span class="bu">Canvas</span></code> class. By default, it calls the <code class="sourceCode java">paint</code> method we provided, which calls <code class="sourceCode java">draw</code>. The reason we use it here is that <code class="sourceCode java">repaint</code> does not require a <code class="sourceCode java"><span class="bu">Graphics</span></code> object as a parameter.</p>
<p><code class="sourceCode java"><span class="bu">Thread</span><span class="op">.</span><span class="fu">sleep</span><span class="op">(</span><span class="dv">500</span><span class="op">)</span></code> causes the program to “sleep” for 500 milliseconds, or a half second. Otherwise, the program would run so fast we would not be able to see the animation.</p>
<p>There’s just one problem: compiling this code results in the error “unreported exception InterruptedException”. This message means we need to do some exception handling.</p>
</section>
<section id="exception-handling" class="level2" data-number="15.8">
<h2 data-number="15.8" class="anchored" data-anchor-id="exception-handling"><span class="header-section-number">15.8</span> Exception Handling</h2>
<p>So far, the only exceptions you have seen are run-time errors like “array index out of bounds” and “null pointer”. When one of these exceptions occurs, Java displays a message and ends the program.</p>
<p>If you don’t want the program to end, you can handle exceptions with a <code class="sourceCode java"><span class="cf">try</span></code>-<code class="sourceCode java"><span class="cf">catch</span></code> statement. The syntax is similar to an <code class="sourceCode java"><span class="cf">if</span></code>-<code class="sourceCode java"><span class="cf">else</span></code> statement, and the logic is, too. Here’s what it looks like:</p>
<div class="sourceCode" id="cb15" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> <span class="op">{</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Thread</span><span class="op">.</span><span class="fu">sleep</span><span class="op">(</span><span class="dv">500</span><span class="op">);</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">InterruptedException</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// do nothing</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>First, Java runs the code in the try block, which calls <code class="sourceCode java"><span class="bu">Thread</span><span class="op">.</span><span class="fu">sleep</span></code> in this example. If an <code class="sourceCode java"><span class="bu">InterruptedException</span></code> occurs during the try block, Java executes the catch block. In this example, the catch block contains a comment, so it doesn’t do anything.</p>
<p>If a different exception occurs during the try block, Java does whatever it would do otherwise, which is probably to display a message and end the program. If no exceptions occur during the try block, the catch block doesn’t run and the program continues.</p>
<p>In this example, the effect of the <code class="sourceCode java"><span class="cf">try</span></code>-<code class="sourceCode java"><span class="cf">catch</span></code> statement is to ignore an “interrupted” exception if it occurs. As an alternative, we could use the catch block to display a customized message, end the program, or handle the exception in whatever way is appropriate. For example, if user input causes an exception, we could catch the exception and prompt the user to try again later.</p>
<p>There’s more to learn about exception handling. You can read about exceptions in the Java tutorials (see <a href="https://thinkjava.org/exceptions" class="uri">https://thinkjava.org/exceptions</a>).</p>
</section>
<section id="counting-neighbors" class="level2" data-number="15.9">
<h2 data-number="15.9" class="anchored" data-anchor-id="counting-neighbors"><span class="header-section-number">15.9</span> Counting Neighbors</h2>
<p>Now that you know about <code class="sourceCode java"><span class="cf">try</span></code> and <code class="sourceCode java"><span class="cf">catch</span></code>, we can use them to implement a useful method in <code class="sourceCode java">GridCanvas</code>. Part of the GoL logic is to count the number of live neighbors. Most cells have eight neighbors, as shown in Figure&nbsp;<a href="#fig:neighbors" data-reference-type="ref" data-reference="fig:neighbors">15.5</a>.</p>
<p>However, cells on the edges and in the corners have fewer neighbors. If we try to count all possible neighbors, we’ll go out of bounds. The following method uses a <code class="sourceCode java"><span class="cf">try</span></code>-<code class="sourceCode java"><span class="cf">catch</span></code> statement to deal with these special cases:</p>
<div class="sourceCode" id="cb16" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">int</span> <span class="fu">test</span><span class="op">(</span><span class="dt">int</span> r<span class="op">,</span> <span class="dt">int</span> c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>array<span class="op">[</span>r<span class="op">][</span>c<span class="op">].</span><span class="fu">isOn</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">ArrayIndexOutOfBoundsException</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// cell doesn't exist</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<figure id="fig:neighbors" class="figure">
<div class="center">
<p><img src="figs/grid-.svg" style="height:1.94444in" class="figure-img"></p>
</div>
<figcaption>
Cells in the interior of the grid have eight neighbors. Cells in the corners and along the edges have fewer neighbors.
</figcaption>
</figure>
<p>The <code class="sourceCode java">test</code> method takes a row index, <code class="sourceCode java">r</code>, and a column index, <code class="sourceCode java">c</code>. It tries to look up the <code class="sourceCode java">Cell</code> at that location. If both indexes are in bounds, the <code class="sourceCode java">Cell</code> exists. In that case, <code class="sourceCode java">test</code> returns <code class="sourceCode java"><span class="dv">1</span></code> if the <code class="sourceCode java">Cell</code> is on. Otherwise, it skips the catch block and returns <code class="sourceCode java"><span class="dv">0</span></code>.</p>
<p>If either index is out of bounds, the array lookup throws an exception, but the catch block ignores it. Then <code class="sourceCode java">test</code> resumes and returns <code class="sourceCode java"><span class="dv">0</span></code>. So the non-existent cells around the perimeter are considered to be off.</p>
<p>Now we can use <code class="sourceCode java">test</code> to implement <code class="sourceCode java">countAlive</code>, which takes a grid location, <code class="sourceCode java"><span class="op">(</span>r<span class="op">,</span> c<span class="op">)</span></code>, and returns the number of live neighbors surrounding that location:</p>
<div class="sourceCode" id="cb17" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">int</span> <span class="fu">countAlive</span><span class="op">(</span><span class="dt">int</span> r<span class="op">,</span> <span class="dt">int</span> c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    count <span class="op">+=</span> grid<span class="op">.</span><span class="fu">test</span><span class="op">(</span>r <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> c <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    count <span class="op">+=</span> grid<span class="op">.</span><span class="fu">test</span><span class="op">(</span>r <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> c<span class="op">);</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    count <span class="op">+=</span> grid<span class="op">.</span><span class="fu">test</span><span class="op">(</span>r <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> c <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    count <span class="op">+=</span> grid<span class="op">.</span><span class="fu">test</span><span class="op">(</span>r<span class="op">,</span> c <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    count <span class="op">+=</span> grid<span class="op">.</span><span class="fu">test</span><span class="op">(</span>r<span class="op">,</span> c <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    count <span class="op">+=</span> grid<span class="op">.</span><span class="fu">test</span><span class="op">(</span>r <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> c <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    count <span class="op">+=</span> grid<span class="op">.</span><span class="fu">test</span><span class="op">(</span>r <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> c<span class="op">);</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    count <span class="op">+=</span> grid<span class="op">.</span><span class="fu">test</span><span class="op">(</span>r <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> c <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> count<span class="op">;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Because <code class="sourceCode java">test</code> handles “out of bounds” exceptions, <code class="sourceCode java">countAlive</code> works for any values of <code class="sourceCode java">r</code> and <code class="sourceCode java">c</code>.</p>
</section>
<section id="sec:update" class="level2" data-number="15.10">
<h2 data-number="15.10" class="anchored" data-anchor-id="sec:update"><span class="header-section-number">15.10</span> Updating the Grid</h2>
<p>Now we are ready to write <code class="sourceCode java">update</code>, which gets invoked each time through the simulation loop. It uses the GoL rules to compute the state of the grid after the next time step:</p>
<div class="sourceCode" id="cb18" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">update</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span><span class="op">[][]</span> counts <span class="op">=</span> <span class="fu">countNeighbors</span><span class="op">();</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateGrid</span><span class="op">(</span>counts<span class="op">);</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The rules of GoL specify that you have to update the cells “simultaneously”; that is, you have to count the neighbors for all cells before you can update any of them.</p>
<p>We do that by traversing the grid twice: first, <code class="sourceCode java">countNeighbors</code> counts the live neighbors for each cell and puts the results in an array named <code class="sourceCode java">counts</code>; second, <code class="sourceCode java">updateGrid</code> updates the cells. Here’s <code class="sourceCode java">countNeighbors</code>:</p>
<div class="sourceCode" id="cb19" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">int</span><span class="op">[][]</span> <span class="fu">countNeighbors</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> rows <span class="op">=</span> grid<span class="op">.</span><span class="fu">numRows</span><span class="op">();</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> cols <span class="op">=</span> grid<span class="op">.</span><span class="fu">numCols</span><span class="op">();</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span><span class="op">[][]</span> counts <span class="op">=</span> <span class="kw">new</span> <span class="dt">int</span><span class="op">[</span>rows<span class="op">][</span>cols<span class="op">];</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> r <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> r <span class="op">&lt;</span> rows<span class="op">;</span> r<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> c <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> c <span class="op">&lt;</span> cols<span class="op">;</span> c<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>            counts<span class="op">[</span>r<span class="op">][</span>c<span class="op">]</span> <span class="op">=</span> <span class="fu">countAlive</span><span class="op">(</span>r<span class="op">,</span> c<span class="op">);</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> counts<span class="op">;</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code class="sourceCode java">countNeighbors</code> traverses the cells in the grid and uses <code class="sourceCode java">countAlive</code> from the previous section to count the neighbors. The return value is a 2D array of integers with the same size as <code class="sourceCode java">grid</code>. Figure&nbsp;<a href="#fig:countNeigh" data-reference-type="ref" data-reference="fig:countNeigh">15.6</a> illustrates an example.</p>
<figure id="fig:countNeigh" class="figure">
<div class="center">
<p><img src="figs/figure15-6.png" style="width:93.0%" class="figure-img"></p>
</div>
<figcaption>
The result of <code class="sourceCode java">countNeighbors</code> for the grid in Section&nbsp;<a href="#conwaymain" data-reference-type="ref" data-reference="conwaymain">15.6</a>.
</figcaption>
</figure>
<p>In contrast to the <code class="sourceCode java">draw</code> method of <code class="sourceCode java">GridCanvas</code>, which uses enhanced <code class="sourceCode java"><span class="cf">for</span></code> loops, <code class="sourceCode java">countNeighbors</code> uses standard <code class="sourceCode java"><span class="cf">for</span></code> loops. The reason is that, in this example, we need the indexes <code class="sourceCode java">r</code> and <code class="sourceCode java">c</code> to store the neighbor counts.</p>
<p><code class="sourceCode java">updateGrid</code> uses <code class="sourceCode java">getCell</code> to select each <code class="sourceCode java">Cell</code> in the grid, and <code class="sourceCode java">updateCell</code> to do the update:</p>
<div class="sourceCode" id="cb20" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">updateGrid</span><span class="op">(</span><span class="dt">int</span><span class="op">[][]</span> counts<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> rows <span class="op">=</span> grid<span class="op">.</span><span class="fu">numRows</span><span class="op">();</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> cols <span class="op">=</span> grid<span class="op">.</span><span class="fu">numCols</span><span class="op">();</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> r <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> r <span class="op">&lt;</span> rows<span class="op">;</span> r<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> c <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> c <span class="op">&lt;</span> cols<span class="op">;</span> c<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>            Cell cell <span class="op">=</span> grid<span class="op">.</span><span class="fu">getCell</span><span class="op">(</span>r<span class="op">,</span> c<span class="op">);</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">updateCell</span><span class="op">(</span>cell<span class="op">,</span> counts<span class="op">[</span>r<span class="op">][</span>c<span class="op">]);</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code class="sourceCode java">updateCell</code> implements the GoL rules: if the cell is alive, it dies if it has fewer than two or more than three neighbors; if the cell is dead, it comes to life if it has exactly three:</p>
<div class="sourceCode" id="cb21" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">updateCell</span><span class="op">(</span>Cell cell<span class="op">,</span> <span class="dt">int</span> count<span class="op">)</span> <span class="op">{</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>cell<span class="op">.</span><span class="fu">isOn</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>count <span class="op">&lt;</span> <span class="dv">2</span> <span class="op">||</span> count <span class="op">&gt;</span> <span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>            cell<span class="op">.</span><span class="fu">turnOff</span><span class="op">();</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>count <span class="op">==</span> <span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>            cell<span class="op">.</span><span class="fu">turnOn</span><span class="op">();</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice that <code class="sourceCode java">updateGrid</code> and <code class="sourceCode java">updateCell</code> are both <code class="sourceCode java"><span class="kw">private</span></code>, because they are helper methods not intended to be invoked from outside the class. <code class="sourceCode java">updateCell</code> is also <code class="sourceCode java"><span class="dt">static</span></code>, because it does not depend on <code class="sourceCode java">grid</code>.</p>
<p>Now our implementation of the Game of Life is complete. We think it’s is pretty fun, and we hope you agree. But more importantly, this example is meant to demonstrate the use of 2D arrays and an object-oriented design that’s a little more substantial than in previous chapters.</p>
</section>
<section id="vocabulary" class="level2" data-number="15.11">
<h2 data-number="15.11" class="anchored" data-anchor-id="vocabulary"><span class="header-section-number">15.11</span> Vocabulary</h2>
<dl>
<dt>multidimensional array:</dt>
<dd>
<p>An array with more than one dimension; a 2D array is an “array of arrays”.</p>
</dd>
<dt>row-major order:</dt>
<dd>
<p>Storing data in a 2D array, first by rows and then by columns.</p>
</dd>
</dl>
</section>
<section id="exercises" class="level2" data-number="15.12">
<h2 data-number="15.12" class="anchored" data-anchor-id="exercises"><span class="header-section-number">15.12</span> Exercises</h2>
<p>The code for this chapter is in the <em>ch15</em> directory of <em>ThinkJavaCode2</em>. See page&nbsp; for instructions on how to download the repository. Before you start the exercises, we recommend that you compile and run the examples.</p>
<div class="exercise">
<p><strong>Exercise 15.1</strong>. <em>In <code class="sourceCode java">GridCanvas</code>, write a method named <code class="sourceCode java">countOn</code> that returns the total number of cells that are “on”. This method can be used, for example, to track the population in Game of Life over time.</em></p>
</div>
<div class="exercise">
<p><strong>Exercise 15.2</strong>. <em>In our version of the Game of Life, the grid has a finite size. As a result, moving objects such as Gliders either crash into the wall or go out of bounds.</em></p>
<p><em>An interesting variation of the Game of Life is a “toroidal” grid, meaning that the cells “wrap around” on the edges. Modify the <code class="sourceCode java">test</code> method of <code class="sourceCode java">GridCanvas</code> so that the coordinates <code class="sourceCode java">r</code> and <code class="sourceCode java">c</code> map to the opposite side of the grid if they are too low or two high.</em></p>
<p><em>Run your code with a Glider (see Figure&nbsp;<a href="#fig:glider" data-reference-type="ref" data-reference="fig:glider">15.1</a>) to see if it works. You can initialize the Glider by modifying the constructor in the <code class="sourceCode java">Conway</code> class, or by reading it from a file (see the next exercise).</em></p>
</div>
<div class="exercise">
<p><strong>Exercise 15.3</strong>. <em>The LifeWiki site (<a href="https://conwaylife.com/wiki/" class="uri">https://conwaylife.com/wiki/</a>) has a fascinating collection of patterns for the Game of Life. These patterns are stored in a file format that is easy to read, in files with the suffix “.cells”.</em></p>
<p><em>For example, here is an 8&nbsp;x&nbsp;10 grid with a Glider near the upper-left corner:</em></p>
<pre><code>!Name: Glider
..........
..O.......
...O......
.OOO......
..........
..........
..........
..........</code></pre>
<p><em>Lines that begin with <code class="sourceCode java"><span class="op">!</span></code> are comments and should be ignored. The rest of the file describes the grid, row by row. A period represents a dead cell, and an uppercase <code>O</code> represents a live cell. See <a href="https://conwaylife.com/wiki/Plaintext" class="uri">https://conwaylife.com/wiki/Plaintext</a> for more examples.</em></p>
<ol type="1">
<li><p><em>Create a plain text file with the contents shown above, and save the file as </em>glider.cells* in the same directory as your code.*</p></li>
<li><p><em>Define a constructor for the <code class="sourceCode java">Conway</code> class that takes a string representing the name (or path) of a “.cells” file. Here is a starting point:</em></p>
<div class="sourceCode" id="cb23" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="fu">Conway</span><span class="op">(</span><span class="bu">String</span> path<span class="op">)</span> <span class="op">{</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">File</span> file <span class="op">=</span> <span class="kw">new</span> <span class="bu">File</span><span class="op">(</span>path<span class="op">);</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Scanner</span> scan <span class="op">=</span> <span class="kw">new</span> <span class="bu">Scanner</span><span class="op">(</span>file<span class="op">);</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><em>Modify the <code class="sourceCode java">main</code> method to invoke the constructor as follows:</em></p>
<div class="sourceCode" id="cb24" data-language="Java"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Conway game <span class="op">=</span> <span class="kw">new</span> <span class="fu">Conway</span><span class="op">(</span><span class="st">"glider.cells"</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><em>Handle the <code class="sourceCode java"><span class="bu">FileNotFoundException</span></code> that may be thrown when creating a <code class="sourceCode java"><span class="bu">Scanner</span></code> for a <code class="sourceCode java"><span class="bu">File</span></code> by invoking <code class="sourceCode java">printStackTrace</code> on the exception object and calling <code class="sourceCode java"><span class="bu">System</span><span class="op">.</span><span class="fu">exit</span><span class="op">()</span></code> with a status of <code class="sourceCode java"><span class="dv">1</span></code>, indicating an error.</em></p></li>
<li><p><em>Continue implementing the constructor by reading all non-comment lines into an <code class="sourceCode java"><span class="bu">ArrayList</span></code> via <code class="sourceCode java">hasNextLine</code> and <code class="sourceCode java">nextLine</code> of the <code class="sourceCode java"><span class="bu">Scanner</span></code>.</em></p></li>
<li><p><em>Determine the number of rows and columns of the grid by examining the <code class="sourceCode java"><span class="bu">ArrayList</span></code> contents.</em></p></li>
<li><p><em>Create and initialize a <code class="sourceCode java">GridCanvas</code> based on the <code class="sourceCode java"><span class="bu">ArrayList</span></code>.</em></p></li>
</ol>
<p><em>Once your constructor is working, you will be able to run many of the patterns on the LifeWiki. You might want to add a margin of empty cells around the initial pattern, to give it room to grow.</em></p>
</div>
<div class="exercise">
<p><strong>Exercise 15.4</strong>. <em>Some files on the LifeWiki use “run-length encoding” (RLE) instead of plain text. The basic idea of RLE is to describe the number of dead and alive cells, rather than type out each individual cell.</em></p>
<p><em>For example, </em>glider.cells* from the previous exercise could be represented this way with RLE:*</p>
<pre><code>#C Name: Glider
x = 10, y = 8
$2bo$3bo$b3o!</code></pre>
<p><em>The first line specifies <code>x</code> (the number of columns) and <code>y</code> (the number of rows). Subsequent lines consist of the letters <code>b</code> (dead), <code>o</code> (alive), and <code>$</code> (end of line), optionally preceded by a count. The pattern ends with <code>!</code>, after which any remaining file contents are ignored.</em></p>
<p><em>Lines beginning with <code>#</code> have special meaning and are not part of the pattern. For example, <code>#C</code> is a comment line. You can read more about RLE format on <a href="https://conwaylife.com/wiki/RLE" class="uri">https://conwaylife.com/wiki/RLE</a>.</em></p>
<ol type="1">
<li><p><em>Create a plain text file with the preceding contents, and save the file as </em>glider.rle* in the same directory as your code.*</p></li>
<li><p><em>Modify your constructor from the previous exercise to check the last three characters of the <code class="sourceCode java">path</code>. If they are <code class="sourceCode java"><span class="st">"rle"</span></code>, then you will need to process the file as RLE. Otherwise, assume the file is in “.cells” format.</em></p></li>
<li><p><em>In the end, your constructor should be able to read and initialize grids in both formats. Test your constructor by modifying the <code class="sourceCode java">main</code> method to read different files.</em></p></li>
</ol>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ch14.html" class="pagination-link" aria-label="Extending Classes">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Extending Classes</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ch16.html" class="pagination-link" aria-label="Reusing Classes">
        <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Reusing Classes</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>